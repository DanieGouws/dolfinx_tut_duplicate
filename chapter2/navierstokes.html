
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Navier-Stokes equations &#8212; FEniCSx tutorial</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Test problem 1: Channel flow (Poiseuille flow)" href="ns_code1.html" />
    <link rel="prev" title="Scaling" href="elasticity_scaling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">FEniCSx tutorial</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   The FEniCSx tutorial
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../fem.html">
   An overview of the FEniCS Project
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Fundamentals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter1/fundamentals.html">
   Solving the Poisson equation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter1/fundamentals_code.html">
     Implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter1/nitsche.html">
   Weak imposition of Dirichlet conditions for the Poisson problem
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter1/membrane.html">
   Deflection of a membrane
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter1/membrane_code.html">
     Implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter1/membrane_paraview.html">
     Using Paraview for visualization
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  A Gallery of finite element solvers
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   A Gallery of finite element solvers
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="heat_equation.html">
   The heat equation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="diffusion_code.html">
     Diffusion of a Gaussian function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="heat_code.html">
     A known analytical solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="nonlinpoisson.html">
   A nonlinear Poisson equation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="nonlinpoisson_code.html">
     Implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="linearelasticity.html">
   The equations of linear elasticity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="linearelasticity_code.html">
     Implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="elasticity_scaling.html">
     Scaling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   The Navier-Stokes equations
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ns_code1.html">
     Test problem 1: Channel flow (Poiseuille flow)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ns_code2.html">
     Test problem 2: Flow past a cylinder (DFG 2D-3 benchmark)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hyperelasticity.html">
   Hyperelasticity
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Subdomains and boundary conditions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/neumann_dirichlet_code.html">
   Combining Dirichlet and Neumann conditions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/multiple_dirichlet.html">
   Setting multiple Dirichlet condition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/subdomains.html">
   Defining subdomains for different materials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/robin_neumann_dirichlet.html">
   Setting multiple Dirichlet, Neumann, and Robin conditions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/component_bc.html">
   Component-wise Dirichlet BC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/em.html">
   Electromagnetics example
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Improving your FEniCSx code
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/solvers.html">
   Solver configuration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/compiler_parameters.html">
   JIT Parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/convergence.html">
   Error control: Computing convergence rates
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chapter2/navierstokes.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jorgensd/dolfinx-tutorial"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jorgensd/dolfinx-tutorial/issues/new?title=Issue%20on%20page%20%2Fchapter2/navierstokes.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/jorgensd/dolfinx-tutorial/edit/dokken/jupyterbook/./chapter2/navierstokes.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-pde-problem">
   The PDE problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variational-formulation">
   Variational formulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-navier-stokes-equations">
<h1>The Navier-Stokes equations<a class="headerlink" href="#the-navier-stokes-equations" title="Permalink to this headline">¶</a></h1>
<p>Authors: Anders Logg and Hans Petter Langtangen</p>
<p>Minor modifications: Jørgen S. Dokken</p>
<p>In this section, we will solve the incompressible Navier-Stokes equations. This problem combines many of the challenges from our previously studied problems: time-dependencies, non-linearity, and vector-valued variables.</p>
<div class="section" id="the-pde-problem">
<h2>The PDE problem<a class="headerlink" href="#the-pde-problem" title="Permalink to this headline">¶</a></h2>
<p>The incompressible Navier-Stokes equations form a system of equations for the velocity <span class="math notranslate nohighlight">\(u\)</span> and pressure <span class="math notranslate nohighlight">\(p\)</span> in an  incompressible fluid</p>
<div class="math notranslate nohighlight" id="equation-navier-stokes">
<span class="eqno">(37)<a class="headerlink" href="#equation-navier-stokes" title="Permalink to this equation">¶</a></span>\[\begin{split}\rho \left( \frac{\partial u }{\partial t} + u \cdot \nabla u \right) &amp;= \nabla \cdot \sigma (u, p) + f,\\
\nabla \cdot u &amp;= 0 \end{split}\]</div>
<p>The right-hand side of <span class="math notranslate nohighlight">\(f\)</span> is a given force per unit volume and just as for the equations of linear elasticity, <span class="math notranslate nohighlight">\(\sigma(u,p)\)</span> denotes the stress tensor, which for a Newtonian fluid is given by</p>
<div class="math notranslate nohighlight" id="equation-navier-stokes-stress">
<span class="eqno">(38)<a class="headerlink" href="#equation-navier-stokes-stress" title="Permalink to this equation">¶</a></span>\[\sigma(u, p)=2\mu \epsilon (u) - pI,\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon(u)\)</span> is the strain-rate tensor</p>
<div class="math notranslate nohighlight">
\[    \epsilon(u)=\frac{1}{2}\left(\nabla u + (\nabla u)^T\right).\]</div>
<p>The parameter <span class="math notranslate nohighlight">\(\mu\)</span> is the dynamic viscosity. Note that the momentum equation <a class="reference internal" href="#equation-navier-stokes">(37)</a> is very similar to the elasticity equation <a class="reference internal" href="linearelasticity.html#equation-elasticity-pde">(33)</a>. The difference is in the two additional terms <span class="math notranslate nohighlight">\(\rho\left(\frac{\partial u}{\partial t}+ u\cdot \nabla u\right)\)</span> and the different expression for the stress tensor. The two extra terms express the acceleration balanced by the force <span class="math notranslate nohighlight">\(F=\nabla \cdot \sigma + f\)</span> per unit volume in Newton’s second law of motion.</p>
</div>
<div class="section" id="variational-formulation">
<h2>Variational formulation<a class="headerlink" href="#variational-formulation" title="Permalink to this headline">¶</a></h2>
<p>The Navier-Stokes equations are different from the time-dependent heat equation in that we need to solve a system of equations and the system of a special type. If we apply the same technique as for the heat equation; that is, replacing the time derivative with a simple difference quotient, we obtain a non-linear system of equations. This in itself is not a problem as we saw for the <a class="reference internal" href="nonlinpoisson.html"><span class="doc std std-doc">non-linear Poisson equation</span></a>, but the system has a so-called <em>saddle point structure</em> and requires special techniques (special preconditioners and iterative methods) to be solved efficiently.</p>
<p>Instead we will apply a simpler and often very efficient approach, known as a <em>splitting method</em>. The idea is to consider the two equations in <a class="reference internal" href="#equation-navier-stokes">(37)</a> separately. There exist many splitting strategies for the incompressible Navier-Stokes equations. One of the oldest is the method proposed by Chorin <span id="id1">[<a class="reference internal" href="#id9">Cho68</a>]</span> and Temam <span id="id2">[<a class="reference internal" href="#id10">Tem69</a>]</span>, often referred to as <em>Chorin’s method</em>. We will use a modified version of Chorin’s method, the so-called incremental pressure correction scheme (IPCS) due to <span id="id3">[<a class="reference internal" href="#id11">God79</a>]</span> which gives improved accuracy compared to the original scheme at little extra cost.</p>
<p>The IPCS scheme involves three steps. First, we compute a <em>tentative velocity <span class="math notranslate nohighlight">\(u\)</span></em> by advancing the momentum equation by a midpoint finite difference scheme in time, but using <span class="math notranslate nohighlight">\(p^n\)</span> from the previous interval. We will also linearize the nonlinear convective term by using the known velocity <span class="math notranslate nohighlight">\(u^n\)</span> from the previous time step: <span class="math notranslate nohighlight">\(u^n\cdot \nabla u^n\)</span>. Note that there exists several other methods to linearize this term, such as the Adams-Bashforth method, see <span id="id4">[<a class="reference internal" href="#id13">Gue99</a>]</span> and <span id="id5">[<a class="reference internal" href="#id12">QSS10</a>]</span>. The variational problem for the first step is: For the <span class="math notranslate nohighlight">\(n+1\)</span>th step, find <span class="math notranslate nohighlight">\(u^*\)</span> such that</p>
<div class="math notranslate nohighlight" id="equation-ipcs-one">
<span class="eqno">(39)<a class="headerlink" href="#equation-ipcs-one" title="Permalink to this equation">¶</a></span>\[\begin{split}    &amp;\left\langle \rho \frac{u^*-u^n}{\Delta t}, v\right\rangle
    + \left\langle \rho u^n\cdot \nabla u^n, v \right\rangle
    +\left\langle \sigma(u^{n+\frac{1}{2}}, p^n), \epsilon(v)\right\rangle\\
    &amp;+ \left\langle p^n n, v \right\rangle_{\partial\Omega}
    -\left\langle \mu \nabla u^{n+\frac{1}{2}}\cdot n, v \right \rangle_{\partial\Omega}=
    \left\langle f^{n+1}, v \right\rangle.\end{split}\]</div>
<p>This notation, suitable for problems wit many terms in the variational formulations, requires some explaination.
First, we use the short-hand notation</p>
<div class="math notranslate nohighlight">
\[\langle v, w \rangle = \int_{\Omega} vw~\mathrm{d}x, \qquad
\langle v, w \rangle_{\partial\Omega}=\int_{\partial\Omega}vw~\mathrm{d}s.\]</div>
<p>This allows us to express the variational problem in a more compact way. Second, we use the notation <span class="math notranslate nohighlight">\(u^{n+\frac{1}{2}}\)</span>. This notation refers to the value of <span class="math notranslate nohighlight">\(u\)</span> at the midpoint of the interval, usually approximated by an arithmetic mean:</p>
<div class="math notranslate nohighlight">
\[   u^{n+\frac{1}{2}}\approx \frac{u^{n}+ u^{n+1}}{2}.\]</div>
<p>Third, we notice that the variational problem <a class="reference internal" href="#equation-ipcs-one">(39)</a> arises from the integration by parts of the term
<span class="math notranslate nohighlight">\(langle -\nabla \cdot \sigma, v\rangle\)</span>. Just as for the <a class="reference internal" href="linearelasticity.html"><span class="doc std std-doc">linear elasticity problem</span></a>, we obtain</p>
<div class="math notranslate nohighlight">
\[    \langle -\nabla \cdot \sigma, v\rangle =
    \langle \sigma, \epsilon(v) \rangle 
    - \langle T, v\rangle_{\partial \Omega},\]</div>
<p>where <span class="math notranslate nohighlight">\(T=\sigma \cdot n\)</span> is the boundary traction. If we solve a problem with a free boundary, we can take <span class="math notranslate nohighlight">\(T=0\)</span> on the boundary. However, if we compute the flow through a channel or a pipe and want to model flow that continues into an “imaginary channel” at the outflow, we need to treat this term with some care.
The assumption we then can make is that the derivative of the velocity in the direction of the channel is zero at the outflow, corresponding to that the flow is “fully developed” or doesn’t change significantly downstream at the outflow.
Doing so, the remaining boundary term at the outflow becomes
<span class="math notranslate nohighlight">\(pn - \mu \nabla u \cdot n\)</span>, which is the term appearing in the variational problem <a class="reference internal" href="#equation-ipcs-one">(39)</a>. Note that this argument and the implementation depends exact on the definition of <span class="math notranslate nohighlight">\(\nabla u\)</span>, as either the  matrix with components <span class="math notranslate nohighlight">\(\frac{\partial u_i}{\partial x_j}\)</span> or <span class="math notranslate nohighlight">\(\frac{\partial u_j}{\partial x_i}\)</span>.
We here choose the  latter, <span class="math notranslate nohighlight">\(\frac{\partial u_j}{\partial x_i}\)</span>,
which means that we must use the UFL-operator <code class="docutils literal notranslate"><span class="pre">nabla_grad</span></code>. If we use the operator <code class="docutils literal notranslate"><span class="pre">grad</span></code> and the definition <span class="math notranslate nohighlight">\(\frac{\partial u_i}{\partial x_j}\)</span>, we must instead keep the terms <span class="math notranslate nohighlight">\(pn-\mu(\nabla u)^T \cdot n\)</span>.</p>
<div class="admonition-the-usage-of-nabla-grad-and-grad admonition">
<p class="admonition-title">The usage of “nabla_grad” and “grad”</p>
<p>As mentioned in the note in <a class="reference internal" href="linearelasticity_code.html"><span class="doc std std-doc">Linear elasticity implementation</span></a> the usage of <code class="docutils literal notranslate"><span class="pre">nabla_grad</span></code> and <code class="docutils literal notranslate"><span class="pre">grad</span></code> has to be interpreted with care. For the Navier-Stokes equations it is important to consider the term <span class="math notranslate nohighlight">\(u\cdot \nabla u\)</span> which should be interpreted as the vector <span class="math notranslate nohighlight">\(w\)</span> with elements
<span class="math notranslate nohighlight">\(w_i=\sum_{j}\left(u_j\frac{\partial}{\partial x_j}\right)u_i = \sum_j u_j\frac{\partial u_i}{\partial x_j}\)</span>.
This term can be  implemented in  FEniCSx as either
<code class="docutils literal notranslate"><span class="pre">grad(u)*u</span></code>, since this expression becomes <span class="math notranslate nohighlight">\(\sum_j\frac{\partial u_j}{\partial x_j}u_j\)</span>, or as <code class="docutils literal notranslate"><span class="pre">dot(u,</span> <span class="pre">nabla_grad(u))</span></code> since this
expression becomes <span class="math notranslate nohighlight">\(\sum_i u_i\frac{\partial u_j}{x_i}\)</span>. We will use the notation <code class="docutils literal notranslate"><span class="pre">dot(u,</span> <span class="pre">nabla_grad(u))</span></code> below since it corresponds more closely to the standard notation <span class="math notranslate nohighlight">\(u\cdot \nabla u\)</span>.</p>
</div>
<p>We now move on to the second step in  our splitting scheme for the incompressible Navier-Stokes equations. In the first step, we computed the <em>tentative velocity</em> <span class="math notranslate nohighlight">\(u^*\)</span> based on the pressure from the previous time step.
We may now use the computed tentative velocity to compute the new pressure <span class="math notranslate nohighlight">\(p^n\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-ipcs-two">
<span class="eqno">(40)<a class="headerlink" href="#equation-ipcs-two" title="Permalink to this equation">¶</a></span>\[    \langle \nabla p^{n+1}, \nabla q \rangle = \langle \nabla p^n, \nabla q\rangle - \Delta t^{-1}\langle \nabla \cdot u^*, q\rangle.\]</div>
<p>Note here that <span class="math notranslate nohighlight">\(q\)</span> is a scalar-valued test function from the pressure space, whereas the test function <span class="math notranslate nohighlight">\(v\)</span> in <a class="reference internal" href="#equation-ipcs-one">(39)</a> is a vector-valued test function from the velocity space.</p>
<p>One way to think about this step is to subtract the Navier-Stokes momentum equation <a class="reference internal" href="#equation-navier-stokes">(37)</a> expressed in terms of the tentative velocity <span class="math notranslate nohighlight">\(u^*\)</span> and the pressure <span class="math notranslate nohighlight">\(p^n\)</span> from the momentum equation expressed in terms of the velocity <span class="math notranslate nohighlight">\(u^{n+1}\)</span> and pressure <span class="math notranslate nohighlight">\(p^{n+1}\)</span>. This results in the equation</p>
<div class="math notranslate nohighlight">
\[\frac{u^{n+1}-u^*}{\Delta t}+\nabla p^{n+1}- \nabla p^n = 0.\]</div>
<p>Taking the divergence and requiring that <span class="math notranslate nohighlight">\(\nabla \cdot u^{n+1}=0\)</span> by the Navier-Stokes continuity equation, we obtain the equation</p>
<div class="math notranslate nohighlight" id="equation-ipcs-tmp">
<span class="eqno">(41)<a class="headerlink" href="#equation-ipcs-tmp" title="Permalink to this equation">¶</a></span>\[ - \frac{\nabla\cdot  u^*}{\Delta t}+ \nabla^2p^{n+1}-\nabla^2p^n=0,\]</div>
<p>which is the Poisson problem for the pressure $p^{n+1} resulting in the variational formulation <a class="reference internal" href="#equation-ipcs-two">(40)</a>.</p>
<p>Finally, we compute the corrected velocity <span class="math notranslate nohighlight">\(u^{n+1}\)</span> from the equation <a class="reference internal" href="#equation-ipcs-tmp">(41)</a>. Multiplying this equation by a test function <span class="math notranslate nohighlight">\(v\)</span>, we obtain</p>
<div class="math notranslate nohighlight">
\[    \langle u^{n+1}, v\rangle=\langle u^*, v\rangle -\Delta t\langle \nabla(p^{n+1}-p^n), v\rangle\]</div>
<p>In summary, we may thus solve the incompressible Navier-Stokes equations efficiently by solving a sequence of three linear variational problems in each step.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="id6"><dl class="citation">
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id1">Cho68</a></span></dt>
<dd><p>Alexandre Joel Chorin. Numerical solution of the Navier-Stokes equations. <em>Mathematics of Computation</em>, 22(104):745–762, 1968. <a class="reference external" href="https://doi.org/10.1090/S0025-5718-1968-0242392-2">doi:10.1090/S0025-5718-1968-0242392-2</a>.</p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id3">God79</a></span></dt>
<dd><p>Katuhiko Goda. A multistep technique with implicit difference schemes for calculating two- or three-dimensional cavity flows. <em>Journal of computational physics</em>, 30(1):76–95, 1979. <a class="reference external" href="https://doi.org/10.1016/0021-9991(79)90088-3">doi:10.1016/0021-9991(79)90088-3</a>.</p>
</dd>
<dt class="label" id="id13"><span class="brackets"><a class="fn-backref" href="#id4">Gue99</a></span></dt>
<dd><p>Jean-Luc Guermond. Un résultat de convergence d'ordre deux en temps pour l'approximation des équations de Navier–Stokes par une technique de projection incrémentale. <em>ESAIM: Mathematical Modelling and Numerical Analysis</em>, 33(1):169–189, 1999. <a class="reference external" href="https://doi.org/10.1051/m2an:1999101">doi:10.1051/m2an:1999101</a>.</p>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id5">QSS10</a></span></dt>
<dd><p>Alfio Quarteroni, Riccardo Sacco, and Fausto Saleri. <em>Numerical mathematics</em>. Volume 37. Springer Science &amp; Business Media, 2010. <a class="reference external" href="https://doi.org/10.1007/b98885">doi:10.1007/b98885</a>.</p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id2">Tem69</a></span></dt>
<dd><p>Roger Temam. Sur l'approximation de la solution des équations de Navier-Stokes par la méthode des pas fractionnaires (I). <em>Archive for Rational Mechanics and Analysis</em>, 32(2):135–153, 1969. <a class="reference external" href="https://doi.org/10.1007/BF00247696">doi:10.1007/BF00247696</a>.</p>
</dd>
</dl>
</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapter2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="elasticity_scaling.html" title="previous page">Scaling</a>
    <a class='right-next' id="next-link" href="ns_code1.html" title="next page">Test problem 1: Channel flow (Poiseuille flow)</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Jørgen S. Dokken<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            <div>
    This webpage is an adaptation of <a href=https://www.springer.com/gp/book/9783319524610>The FEniCS tutorial</a> and
    is distributed under the terms of the      <a href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License  </a>
    which permits use, duplication, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source,
    provide a link to the Creative Commons license and indicate if changes were made.
</div>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>